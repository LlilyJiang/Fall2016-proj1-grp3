---
title: "Women in Work Force"
output: html_notebook
---

```{r} 
#Importing Data Set
ss14pusa = read.csv(file.choose(),header=TRUE)  # read csv file
ss14pusb = read.csv(file.choose(),header=TRUE)

#Libraries
require(plyr)
require(dplyr)
```

```{r}
#Importing Data Set in a faster way
library(data.table)
variables=c("SEX","OCCP","WKHP","MAR","WAGP","SCHL","ESP","RAC1P","ST","PAOC","PWGTP")
ss14pusa=fread("C:/Users/user/Desktop/Statistics/3rd semester/ADS/Project1/csv_pus/ss14pusa.csv",head=TRUE,select=variables)
ss14pusb=fread("C:/Users/user/Desktop/Statistics/3rd semester/ADS/Project1/csv_pus/ss14pusb.csv",head=TRUE,select=variables)
```

```{r}
attach(ss14pusa)
names(ss14pusa)
ss14pusa_edit = data.frame(SEX,OCCP,WKHP,MAR,WAGP,SCHL,ESP, RAC1P, ST, PAOC, PWGTP)
detach(ss14pusa)

attach(ss14pusb)
ss14pusb_edit = data.frame(SEX,OCCP,WKHP,MAR,WAGP,SCHL,ESP, RAC1P, ST, PAOC, PWGTP)
detach(ss14pusb)

Data = rbind(ss14pusa_edit,ss14pusb_edit)
colnames(Data) <- c("Gender","Occupation", "Work_hours", "Marriage", "Income", "Education" ,"Parental_Occupation", "Race", "State", "Children", "Weight")


write.csv(Data, file = "Data.csv",row.names=TRUE)
```

```{r}
#Delete income=0/NA rows
row_to_keep=which(Data$Income>0)
Data=Data[row_to_keep,]
```

```{r, echo = FALSE}
#recode OCCP
class(Data$Occupation) <- "numeric"
Data$Occupation <- ifelse(Data$Occupation >= 10 & Data$Occupation <= 430, 1, Data$Occupation)
Data$Occupation <- ifelse(Data$Occupation >= 1005 & Data$Occupation <= 1240, 2, Data$Occupation)
Data$Occupation <- ifelse(Data$Occupation >= 800 & Data$Occupation <= 950, 3, Data$Occupation)
Data$Occupation <- ifelse(Data$Occupation >= 2105 & Data$Occupation <= 2160, 4, Data$Occupation)
Data$Occupation <- ifelse(Data$Occupation >= 3000 & Data$Occupation <= 3540, 5, Data$Occupation)
Data$Occupation <- ifelse(Data$Occupation >= 510 & Data$Occupation <= 740, 6, Data$Occupation)
Data$Occupation <- ifelse(Data$Occupation >= 1300 & Data$Occupation <= 1560, 7, Data$Occupation)
Data$Occupation <- ifelse(Data$Occupation >= 1600 & Data$Occupation <= 1965, 8, Data$Occupation)

Data <- filter(Data, Occupation %in% c(1:8))
Data$Occupation <- as.factor(Data$Occupation)

levels(Data$Occupation) <- c('MGR', 'CMM', 'FIN', 'LGL', 'MED' , 'BUS', 'ENG', 'SCI')

#Recode Region
#https://en.wikipedia.org/wiki/List_of_regions_of_the_United_States#/media/File:Census_Regions_and_Division_of_the_United_States.svg
Data$Region <- recode(Data$State,"c(09,23,25,33,44,59,34,36,42)='Northeast';c(17,18,26,38,55,19,20,27,29,31,38,46)='Mid West'; c(10,12,13,24,37,45,51,11,54,01,21,28,47,05,22,40,48)='South';c(04,08,16,30,32,35,49,50,02,06,15,41,53)='West'))

```

Hayoung's part - explore education factor
```{r}
#Recode Education
library(car)
Data$Education <- recode(Data$Education,"1:11='~grade8';12:19='grade9~college_nodegree';20:21='associate/bachelor';22:23='master/professional';24='doctor'")
```
```{r}
#Recode Gender
Data$Gender <- recode(Data$Gender,"1='Male';2='Female'")
```

Q. What is the median income?
```{r}
median_income<-median(Data$Income)
median_income 
```
* median income of working class(male+female) is $31000

Q. below median vs.above median percentage of each sex?
```{r}
Data$Income_median<-ifelse(Data$Income>=median_income,"2.above","1.below")
prop.table(table(Data$Income_median,Data$Gender),2)
barplot(prop.table(table(Data$Income_median,Data$Gender),2),legend.text=TRUE,horiz=TRUE)
```
* below median percentage of female (57% of female) >> below median percentage of male (42% of male)

Q. below income educational attainment vs. above income educational attainment
```{r}
Data$Education=factor(Data$Education,c("~grade8","grade9~college_nodegree","associate/bachelor","master/professional","doctor"))
prop.table(table(Data$Income_median,Data$Education),2)
barplot(prop.table(table(Data$Income_median,Data$Education),2),legend.text=TRUE,horiz=TRUE)
```
* with bachelor's degree at least, more than half are "above group" / without degrees, more than half are "below group"

Q. Devide by gender
```{r}
table1<-prop.table(xtabs(~Data$Income_median+Data$Education+Data$Gender),c(1,3))
#plot seperately
Data_women<-subset(Data,Gender=='Female')
Data_men<-subset(Data,Gender=='Male')
par(mfrow=c(1,2))
#female
barplot(prop.table(table(Data_women$Income_median,Data_women$Education),2),legend.text=TRUE,horiz=TRUE)
#male
barplot(prop.table(table(Data_men$Income_median,Data_men$Education),2),legend.text=TRUE,horiz=TRUE)
```
* at each educational attainment, female's below portion is higher than male

Q. Education effect on income
```{r}
boxplot(Income~Education, data=Data[,], main=toupper("Income by Educational attainment"), font.main=3, cex.main=1.2, xlab="Educational attainment", ylab="Income", font.lab=1, col="darkgreen")
```
* Educational attainment does affect the income (median increases at higher attainment)

Q.Devide by gender: Does Educational attainment affect female more than male?
```{r}
library(ggplot2)
boxplot_data <- data.frame(Data$Gender,Data$Education,Data$Income)
ggplot(data = boxplot_data, aes(x=Data$Education, y=Data$Income)) + geom_boxplot(aes(fill=Data$Gender))
```
* Educational attainment does affect the female's income, but male's as well

```{r, echo = FALSE}
#add in weights...example code from previous project:

df1<-svrepdesign(variables=pus_new[,1:13], 
repweights=pus_new[,14:93], type="BRR",combined.weights=TRUE,
weights=pus_new$PWGTP)
summary(df1)
svymean(~ WAGP,df1, na.rm = T)

#If We only want to know the SE and Mean of Statistics Income?

pus_new$FOD1P[pus_new$FOD1P == 3702 | pus_new$FOD1P == 6212 | pus_new$FOD1P == 6202]<-"Statistics"
df<-subset(pus_new, pus_new$FOD1P=="Statistics")
df2<-svrepdesign(variables=df[,1:13], 
repweights=df[,14:93], type="BRR",combined.weights=TRUE,
weights=df$PWGTP)
summary(df2)
svymean(~ WAGP,df2, na.rm = T)
```

```{r, echo = FALSE}

#median wage for each occupation by gender (just to acknowledge that there *is* a gender gap)

Data_sex_occp <- ddply(Data, .(Gender, Occupation), summarise, MEAN = weighted.mean(Income, Weight, na.rm = T))
ggplot(Data_sex_occp, aes(x=Occupation, y=MEAN, fill=factor(Gender))) + 
  geom_bar(stat="identity",position="dodge") + 
  scale_fill_brewer(palette="RdYlGn") +
  labs(fill="") + 
  ylab("Mean Salary ($)") + 
  xlab("Occupations") + 
  ggtitle(paste("Salary Comparison between Men & Women")) + 
  theme(axis.text.x = element_text(angle = 30, hjust = 1), 
        panel.background = element_rect(fill = 'white' )) + 
  theme_grey(base_size = 12)

```

```{r, echo = FALSE}
#subset on women, explore groups of women
Data_women <- filter(Data, Gender == 2)
#Race - Catherine
#Motherhood - 
#Marital Status - Erica (potentially add in region)
#Proportion of graduate degrees in each occupation?
#Region - Vivien

```

```{r, echo = FALSE}

```

```{r, echo = FALSE}
Data_women <- filter(Data, Gender == 2)
MotherHood=select(Data_women, Income,Children)
#detach(package:plyr)
GroupedMotherHood <-
  MotherHood %>%
  na.omit() %>%
  group_by(Children) %>% 
  summarize(
    AvgIncome = mean(Income)
  ) 


### Bar Chart
ggplot(GroupedMotherHood, aes(x=Children, y=AvgIncome)) + 
  geom_bar(colour="black", fill="#DD8888", width=.5, stat="identity") + 
  guides(fill=FALSE) +
  xlab("Children") + ylab("Mean Income") +
  coord_cartesian(ylim = c(50000,70000)) +
  #scale_y_continuous(limits = c(40000,70000),oob = rescale_none) +
  ggtitle("Income for Motherhood")



### 
```

```{r}
MotherWorking=select(Data_women, Income,Children,Work_hours)
#detach(package:plyr)
GroupedMotherWorking <-
  MotherWorking %>%
  na.omit() %>%
  group_by(Children,Work_hours) %>% 
  summarize(
    AvgIncome = mean(Income),
    count=n()
  ) 

library(plotly)
# note how size is automatically scaled and added as hover text

plot_ly(GroupedMotherWorking, x = Work_hours, y = AvgIncome,size=sqrt(count), color = Children,text = paste("Count: ", count),opacity=1-Children*0.2,mode = "markers")

#plot_ly(GroupedMotherWorking, x = Work_hours, y = AvgIncome, text = paste("Count: ", #count),mode = "markers", opacity=1-Children*0.2,color = Children)
```
Observations:
1. When work_hours smaller than 60Hrs, Avg Income tend to be positively related to work hour.
2. There are generally more females with no Children
3. Females with Children from 6 to 17 often has higher avg income
```{r}
MotherOccupation=select(Data_women, Income,Children,Occupation)
#detach(package:plyr)
GroupedMotherOccupation <-
  MotherOccupation %>%
  na.omit() %>%
  group_by(Children,Occupation) %>% 
  summarize(
    AvgIncome = mean(Income),
    count=n()
  ) 


revalue(GroupedMotherOccupation$Children,c('1'='Children under 6','2'='Children from 6 to 17','3'='Children under 6 and above 6','4'='No Children'))

ggplot(GroupedMotherOccupation,aes(x=Children))+geom_point(aes(y=Occupation,size=count,colour=AvgIncome))+scale_colour_gradient(low="green",high="red")+scale_x_continuous(breaks=1:4, labels=c("Children under 6", "Children from 6 to 17", "Children under 6 and above 6", "No Children")) 

#scale_colour_gradientn(colours = terrain.colors(10))
```
Observations:
1. Females with Children from 6 to 17 usually tend to have higher average income as the dot has darker color.
2. Occupation of ENG, MGR and CMM usually tend to have higher salary. On the other hand, female in LGL field always have lower salary
3. 

