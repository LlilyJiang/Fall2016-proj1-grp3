---
title: "Women in Work Force"
output: html_notebook
---

```{r} 
#Importing Data Set
ss14pusa = read.csv(file.choose(),header=TRUE)  # read csv file
ss14pusb = read.csv(file.choose(),header=TRUE)

#Libraries
require(plyr)
require(dplyr)
```

```{r}
#Importing Data Set in a faster way
library(data.table)
variables=c("SEX","OCCP","WKHP","MAR","WAGP","SCHL","ESP","RAC1P","ST","PAOC","PWGTP")
ss14pusa=fread("C:/Users/user/Desktop/Statistics/3rd semester/ADS/Project1/csv_pus/ss14pusa.csv",head=TRUE,select=variables)
ss14pusb=fread("C:/Users/user/Desktop/Statistics/3rd semester/ADS/Project1/csv_pus/ss14pusb.csv",head=TRUE,select=variables)
```

```{r}
attach(ss14pusa)
names(ss14pusa)
ss14pusa_edit = data.frame(SEX,OCCP,WKHP,MAR,WAGP,SCHL,ESP, RAC1P, ST, PAOC, PWGTP)
detach(ss14pusa)

attach(ss14pusb)
ss14pusb_edit = data.frame(SEX,OCCP,WKHP,MAR,WAGP,SCHL,ESP, RAC1P, ST, PAOC, PWGTP)
detach(ss14pusb)

Data = rbind(ss14pusa_edit,ss14pusb_edit)
colnames(Data) <- c("Gender","Occupation", "Work_hours", "Marriage", "Income", "Education" ,"Parental_Occupation", "Race", "State", "Children", "Weight")


write.csv(Data, file = "Data.csv",row.names=TRUE)
```

```{r}
#Delete income=0/NA rows
row_to_keep=which(Data$Income>0)
Data=Data[row_to_keep,]
```

```{r, echo = FALSE}
#recode OCCP
class(Data$Occupation) <- "numeric"
Data$Occupation <- ifelse(Data$Occupation >= 10 & Data$Occupation <= 430, 1, Data$Occupation)
Data$Occupation <- ifelse(Data$Occupation >= 1005 & Data$Occupation <= 1240, 2, Data$Occupation)
Data$Occupation <- ifelse(Data$Occupation >= 800 & Data$Occupation <= 950, 3, Data$Occupation)
Data$Occupation <- ifelse(Data$Occupation >= 2105 & Data$Occupation <= 2160, 4, Data$Occupation)
Data$Occupation <- ifelse(Data$Occupation >= 3000 & Data$Occupation <= 3540, 5, Data$Occupation)
Data$Occupation <- ifelse(Data$Occupation >= 510 & Data$Occupation <= 740, 6, Data$Occupation)
Data$Occupation <- ifelse(Data$Occupation >= 1300 & Data$Occupation <= 1560, 7, Data$Occupation)
Data$Occupation <- ifelse(Data$Occupation >= 1600 & Data$Occupation <= 1965, 8, Data$Occupation)

row_to_keep2=which(Data$Occupation%in% c(1:8))
Data <- Data[row_to_keep2,]
Data$Occupation <- as.factor(Data$Occupation)

levels(Data$Occupation) <- c('MGR', 'CMM', 'FIN', 'LGL', 'MED' , 'BUS', 'ENG', 'SCI')

#Recode Region
#https://en.wikipedia.org/wiki/List_of_regions_of_the_United_States#/media/File:Census_Regions_and_Division_of_the_United_States.svg
Data$Region <- recode(Data$State,"c(09,23,25,33,44,59,34,36,42)='Northeast';c(17,18,26,38,55,19,20,27,29,31,38,46)='Mid West'; c(10,12,13,24,37,45,51,11,54,01,21,28,47,05,22,40,48)='South';c(04,08,16,30,32,35,49,50,02,06,15,41,53)='West'))

```



```{r, echo = FALSE}

#add in weights...example code from previous project:

df1<-svrepdesign(variables=pus_new[,1:13], 
repweights=pus_new[,14:93], type="BRR",combined.weights=TRUE,
weights=pus_new$PWGTP)
summary(df1)
svymean(~ WAGP,df1, na.rm = T)

#If We only want to know the SE and Mean of Statistics Income?

pus_new$FOD1P[pus_new$FOD1P == 3702 | pus_new$FOD1P == 6212 | pus_new$FOD1P == 6202]<-"Statistics"
df<-subset(pus_new, pus_new$FOD1P=="Statistics")
df2<-svrepdesign(variables=df[,1:13], 
repweights=df[,14:93], type="BRR",combined.weights=TRUE,
weights=df$PWGTP)
summary(df2)
svymean(~ WAGP,df2, na.rm = T)
```

```{r, echo = FALSE}

#median wage for each occupation by gender (just to acknowledge that there *is* a gender gap)

Data_sex_occp <- ddply(Data, .(Gender, Occupation), summarise, MEAN = weighted.mean(Income, Weight, na.rm = T))
ggplot(Data_sex_occp, aes(x=Occupation, y=MEAN, fill=factor(Gender))) + 
  geom_bar(stat="identity",position="dodge") + 
  scale_fill_brewer(palette="RdYlGn") +
  labs(fill="") + 
  ylab("Mean Salary ($)") + 
  xlab("Occupations") + 
  ggtitle(paste("Salary Comparison between Men & Women")) + 
  theme(axis.text.x = element_text(angle = 30, hjust = 1), 
        panel.background = element_rect(fill = 'white' )) + 
  theme_grey(base_size = 12)

```

```{r, echo = FALSE}
#subset on women, explore groups of women
Data_women <- filter(Data, Gender == 2)
#Race - Catherine
#Motherhood - 
#Marital Status - Erica (potentially add in region)
#Proportion of graduate degrees in each occupation?
#Region - Vivien

```

```{r, echo = FALSE}

```

```{r, echo = FALSE}
Data_women <- filter(Data, Gender == 2)
MotherHood=select(Data_women, Income,Children)
#detach(package:plyr)
GroupedMotherHood <-
  MotherHood %>%
  na.omit() %>%
  group_by(Children) %>% 
  summarize(
    AvgIncome = mean(Income)
  ) 


### Bar Chart
ggplot(GroupedMotherHood, aes(x=Children, y=AvgIncome)) + 
  geom_bar(colour="black", fill="#DD8888", width=.5, stat="identity") + 
  guides(fill=FALSE) +
  xlab("Children") + ylab("Mean Income") +
  coord_cartesian(ylim = c(50000,70000)) +
  #scale_y_continuous(limits = c(40000,70000),oob = rescale_none) +
  ggtitle("Income for Motherhood")



### 
```

```{r}
MotherWorking=select(Data_women, Income,Children,Work_hours)
#detach(package:plyr)
GroupedMotherWorking <-
  MotherWorking %>%
  na.omit() %>%
  group_by(Children,Work_hours) %>% 
  summarize(
    AvgIncome = mean(Income),
    count=n()
  ) 

library(plotly)
# note how size is automatically scaled and added as hover text

plot_ly(GroupedMotherWorking, x = Work_hours, y = AvgIncome,size=sqrt(count), color = Children,text = paste("Count: ", count),opacity=1-Children*0.2,mode = "markers")

#plot_ly(GroupedMotherWorking, x = Work_hours, y = AvgIncome, text = paste("Count: ", #count),mode = "markers", opacity=1-Children*0.2,color = Children)
```
Observations:
1. When work_hours smaller than 60Hrs, Avg Income tend to be positively related to work hour.
2. There are generally more females with no Children
3. Females with Children from 6 to 17 often has higher avg income
```{r}
MotherOccupation=select(Data_women, Income,Children,Occupation)
#detach(package:plyr)
GroupedMotherOccupation <-
  MotherOccupation %>%
  na.omit() %>%
  group_by(Children,Occupation) %>% 
  summarize(
    AvgIncome = mean(Income),
    count=n()
  ) 


revalue(GroupedMotherOccupation$Children,c('1'='Children under 6','2'='Children from 6 to 17','3'='Children under 6 and above 6','4'='No Children'))

ggplot(GroupedMotherOccupation,aes(x=Children))+geom_point(aes(y=Occupation,size=count,colour=AvgIncome))+scale_colour_gradient(low="green",high="red")+scale_x_continuous(breaks=1:4, labels=c("Children under 6", "Children from 6 to 17", "Children under 6 and above 6", "No Children")) 

#scale_colour_gradientn(colours = terrain.colors(10))
```
Observations:
1. Females with Children from 6 to 17 usually tend to have higher average income as the dot has darker color.
2. Occupation of ENG, MGR and CMM usually tend to have higher salary. On the other hand, female in LGL field always have lower salary
3. 

EXPLORE EDUCATION FACTOR

We divided female into 2 groups (>=$60,000 vs <60,000) using weighted median income for working class. ($60,000)
We will see the proportion of these 2 groups for each educational attainment.
```{r}
#Recode Education : used number as it is order statistics
library(car)
Data$Education <- recode(Data$Education,"1:11='1';12:19='2';20:21='3';22:23='4';24='5'")

#Calculate weighted median to split income below/above
library(survey)
Data_w<-svydesign(id = ~1, weights = ~Data$Weight, data = Data)
svyquantile(~Data$Income, Data_w, c(.25,.5,.75))
##Median income=$60000

#split income below/above
Data$Income_m<-ifelse(Data$Income>=60000,">=$60,000","<$60,000")

#get the data frame needed: education, race effect on income(below/above)
names(Data)
Data_women<-subset(Data,Gender=='2')
attach(Data_women)
Data_women<-data.frame(Education,Occupation,Income_m,Weight)
detach(Data_women)


#get the summary table-education
Data_women_w<-svydesign(id = ~1, weights = ~Data_women$Weight, data = Data_women)
t1<-prop.table(svytable(~Income_m+Education, Data_women_w),2)
barplot(t1, main = "Below/Above median income women by Educational attainment",col = c("mistyrose", "lavender"),
xlab = "Educational attainment", names = c("~g8", "g9~nodegree","ass/bach","prof/mas","doc"), 
ylab = "proportion", legend = c("<$60,000", ">=$60,000"), 
args.legend = list(title = "income", x = "topright", cex = 1), ylim = c(0, 1.5))
##<=60000 percentage decreases at higher educational attainment
##No difference between "1: ~grade8 group" and "2: grade9~no_college_degree group"
##With "4: master's degree" at least, more than half proportion are above median income
```
Observations:
1. Without college degree, about 80% of them earn less than median income.
2. With master's or doctor's degree, about 40% of them earn less than median income.

We will do linear regression to confirm this fact.
```{r}
fit_edu<-svyglm(factor(Income_m) ~ factor(Education), design = Data_women_w,family=binomial)
summary(fit_edu)
##interpretation on logit scale
##Education2(grade9~college_no_degree), versus Education1(~grade8:baseline) multiplies the odds of being ">=$60000" group by exp(-0.068)
##Same interpretation as above for Education 3,4,5
##From Education2(grade9~college_no_degree), the chance of being ">=$60000" group increases at higher educational attainment, 
##gap between master's and doctor's degree is relatively not much

```
Observations:
1. factor2 is not significant.
2. Interpretation for factor3: "associate/bachelor's degree", versus "~grade8"(baseline), multiplies the odds of being ">=$60000" group by exp(0.94372)
3. We can apply the same interpretation for factor 4,5,6.
4. Within college, master, doctor's degree, the chance of being in ">=$60000" group increases at higher educational attainment.
5. However, the gap between master's and doctor's degree is relatively small.

We are going to break down each education by occupation.
```{r}
t2<-prop.table(svytable(~Income_m+Occupation+Education, Data_women_w),c(2,3))
#break down into occupation
#~grade8
barplot(t2[,,1],main = "~grade8, by occupation",col = c("mistyrose", "white"),
xlab = "occupation", names = c('MGR', 'CMM', 'FIN', 'LGL', 'MED' , 'BUS', 'ENG', 'SCI'), 
ylab = "proportion", legend = c("<$60,000", ">=$60,000"), 
args.legend = list(title = "Income", x = "topright", cex = 1), ylim = c(0, 1.5))
##CMM->relatively high proportion of ">=60000 group"
```
Observations:
1. Within "~grade8", "FIN" has the largest proportion of <$60,000 group.
2. "CMM" has the smallest proportion of <$60,000 group.

```{r}
#grade9~college_no_degree
barplot(t2[,,2],main = "grade9~college_no_degree, by occupation",col = c("mistyrose", "white"),
xlab = "occupation", names = c('MGR', 'CMM', 'FIN', 'LGL', 'MED' , 'BUS', 'ENG', 'SCI'), 
ylab = "proportion", legend = c("<$60,000", ">=$60,000"), 
args.legend = list(title = "Income", x = "topright", cex = 1), ylim = c(0, 1.5))
##~gat CMM field,
```
Observations:
1. Within "grade9~college_no_degree", "SCI" has the largest proportion of <$60,000 group.
2. "CMM" has the smallest proportion of <$60,000 group.
```{r}
#associate/bachelor
barplot(t2[,,3],main = "associate/bachelor, by occupation",col = c("mistyrose", "white"),
xlab = "occupation", names = c('MGR', 'CMM', 'FIN', 'LGL', 'MED' , 'BUS', 'ENG', 'SCI'), 
ylab = "proportion", legend = c("<$60,000", ">=$60,000"), 
args.legend = list(title = "Income", x = "topright", cex = 1), ylim = c(0, 1.5))
##CMM and ENG is the best, LGL is the worst
```
Observations:
1. Within "associate/bachelor", "LGL" has the largest proportion of <$60,000 group.
2. "CMM" has the smallest proportion of <$60,000 group.
```{r}
#master/professional
barplot(t2[,,4],main = "master, by occupation",col = c("mistyrose", "white"),
xlab = "occupation", names = c('MGR', 'CMM', 'FIN', 'LGL', 'MED' , 'BUS', 'ENG', 'SCI'), 
ylab = "proportion", legend = c("<$60,000", ">=$60,000"), 
args.legend = list(title = "Income", x = "topright", cex = 1), ylim = c(0, 1.5))
##same as in bachelor
```
Observations:
1. Within "Master", "LGL" has the largest proportion of <$60,000 group.
2. "CMM" has the smallest proportion of <$60,000 group.
```{r}
#doctor
barplot(t2[,,5],main = "doctor, by occupation",col = c("mistyrose", "white"),
xlab = "occupation", names = c('MGR', 'CMM', 'FIN', 'LGL', 'MED' , 'BUS', 'ENG', 'SCI'), 
ylab = "proportion", legend = c("<$60,000", ">=$60,000"), 
args.legend = list(title = "Income", x = "topright", cex = 1), ylim = c(0, 1.5))
##MGR is the best, LGL is the worst
```
Observations:
1. Within "Doctor", "LGL" has the largest proportion of <$60,000 group.
2. "CMM" has the smallest proportion of <$60,000 group.

